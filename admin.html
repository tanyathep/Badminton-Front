<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Badminton SUT 2025</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* ‡πÄ‡∏û‡∏¥‡πà‡∏° CSS ‡πÄ‡∏â‡∏û‡∏≤‡∏∞ Admin */
        :root {
            --primary-color: #3498db; /* ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏™‡∏µ‡∏´‡∏•‡∏±‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö CSS ‡πÄ‡∏î‡∏¥‡∏° */
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            color: #333;
        }
        .header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .header-nav a {
            color: white;
            text-decoration: none;
            font-weight: bold;
            padding: 8px 12px;
            border-radius: 4px;
            background-color: #e74c3c;
            transition: background-color 0.3s;
        }
        .header-nav a:hover {
             background-color: #c0392b;
        }
        .container {
            width: 95%;
            margin: 20px auto;
        }
        .card {
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="email"],
        input[type="password"],
        select,
        input[type="file"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        .submit-button {
            background-color: #e67e22;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s ease;
            width: auto; /* ‡∏õ‡∏£‡∏±‡∏ö‡πÉ‡∏´‡πâ‡∏õ‡∏∏‡πà‡∏° Login ‡∏°‡∏µ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏ß‡πâ‡∏≤‡∏á‡∏ï‡∏≤‡∏°‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤ */
        }
        .submit-button:hover {
            background-color: #d35400;
        }

        .admin-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        .admin-table th, .admin-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
            font-size: 0.85em;
        }
        .admin-table th {
            background-color: var(--primary-color);
            color: white;
            cursor: pointer;
        }
        .admin-table td a {
            color: var(--primary-color);
            text-decoration: none;
        }
        .admin-table td button {
            padding: 5px 10px;
            cursor: pointer;
            border: none;
            border-radius: 4px;
            margin-right: 5px;
        }
        .status-select {
            padding: 5px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }
        /* ‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏° */
        .btn-update { background-color: #4CAF50; color: white; }
        .btn-view { background-color: #2196F3; color: white; }
        
        /* Modal Style */
        .modal-overlay {
            display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0,0,0,0.4);
        }
        .modal-content-custom {
            background-color: white; 
            margin: 5% auto; 
            padding: 20px; 
            border: 1px solid #888; 
            width: 80%; 
            max-width: 700px;
            border-radius: 8px;
            position: relative;
        }
        .modal-content-custom .close-button {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .modal-content-custom .close-button:hover {
            color: #000;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">BADMINTON SUT 2025 (ADMIN)</div>
        <div class="header-nav">
            <a href="#" id="logoutButton" style="display: none;"><i class="fas fa-sign-out-alt"></i> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö</a>
        </div>
    </div>
    
    <div class="container">
        <div id="loginSection" class="card" style="max-width: 400px; margin: 50px auto;">
            <h2>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö Admin</h2>
            <div id="loginError" style="color: red; margin-bottom: 10px;"></div>
            <div class="form-group">
                <label for="adminEmail">Email</label>
                <input type="email" id="adminEmail" value="sutbadminton@gmail.com" required>
            </div>
            <div class="form-group">
                <label for="adminPassword">Password</label>
                <input type="password" id="adminPassword" value="99887766" required>
            </div>
            <button id="loginButton" class="submit-button" style="width: 100%;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
        </div>

        <div id="dashboardSection" style="display: none;">
            
            <div class="card">
                <h2><i class="fas fa-qrcode"></i> ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ QR Code ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h2>
                <div id="currentQr" style="margin-bottom: 15px;"></div>
                <div class="form-group">
                    <label for="qrCodeFile">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î QR Code (‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô):</label>
                    <input type="file" id="qrCodeFile" accept="image/*" required>
                </div>
                <button id="uploadQrButton" class="submit-button" style="background-color: #f39c12; width: 100%;">‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å QR Code</button>
                <div id="qrUploadMessage" style="margin-top: 10px;"></div>
            </div>
            
            <div class="card">
                <h2><i class="fas fa-users"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏π‡πâ‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h2>
                <div style="margin-bottom: 10px; font-weight: bold;">
                    ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ó‡∏µ‡∏°‡∏£‡∏ß‡∏°: <span id="teamCount">0</span>
                </div>
                <div style="overflow-x: auto;">
                    <table class="admin-table">
                        <thead>
                            <tr>
                                <th style="width: 10%;">‡∏£‡∏´‡∏±‡∏™‡∏ó‡∏µ‡∏°</th>
                                <th style="width: 15%;">‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°</th>
                                <th style="width: 5%;">‡∏£‡∏∏‡πà‡∏ô</th>
                                <th style="width: 10%;">‡∏ß‡∏¥‡∏ò‡∏µ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</th>
                                <th style="width: 10%;">‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô Slip</th> <th style="width: 15%;">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</th>
                                <th style="width: 25%;">‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                            </tr>
                        </thead>
                        <tbody id="teamListBody">
                            </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <div id="detailModal" class="modal-overlay">
        <div class="modal-content-custom">
            <span onclick="document.getElementById('detailModal').style.display='none'" class="close-button">&times;</span>
            <h3>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ó‡∏µ‡∏°: <span id="modalTeamName"></span> (<span id="modalTeamCode"></span>)</h3>
            <div id="modalContent"></div>
            <button onclick="document.getElementById('detailModal').style.display='none'" class="submit-button" style="background-color: #f44336; margin-top: 20px;">‡∏õ‡∏¥‡∏î</button>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
    // 1. ‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏Ñ‡πà‡∏≤ Supabase Key (‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏£‡∏≠‡∏ö‡∏î‡πâ‡∏ß‡∏¢ Single Quote ' ')
    // *** ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÉ‡∏™‡πà Project URL ‡πÅ‡∏•‡∏∞ ANON/PUBLIC KEY ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ï‡∏£‡∏á‡∏ô‡∏µ‡πâ (‡∏û‡∏£‡πâ‡∏≠‡∏° Single Quote) ***
    const SUPABASE_URL = 'https://ivqepmhiqdwrmkwjrlra.supabase.co'; 
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Iml2cWVwbWhpcWR3cm1rd2pybHJhIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjU2NTIwMDAsImV4cCI6MjA4MTIyODAwMH0.0F5mBzoc3x1EC_PoxY5Y-atc3ZEm4GTej7MsyCd6saE'; 
    
    // 2. ‡∏™‡∏£‡πâ‡∏≤‡∏á Client Object (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ReferenceError ‡πÇ‡∏î‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ä‡∏∑‡πà‡∏≠‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£)
    const supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
    
    // --- 1. ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ Authentication ---
    async function checkAuth() {
        // ‡πÉ‡∏ä‡πâ supabaseClient
        const { data: { user } } = await supabaseClient.auth.getUser(); 
        
        if (user && user.email === 'sutbadminton@gmail.com') { 
            showDashboard();
            fetchTeamList();
        } else {
            showLogin();
        }
    }

    function showLogin() {
        document.getElementById('loginSection').style.display = 'block';
        document.getElementById('dashboardSection').style.display = 'none';
        document.getElementById('logoutButton').style.display = 'none';
    }

    function showDashboard() {
        document.getElementById('loginSection').style.display = 'none';
        document.getElementById('dashboardSection').style.display = 'block';
        document.getElementById('logoutButton').style.display = 'block';
        fetchQrCodePath(); // ‡πÄ‡∏û‡∏¥‡πà‡∏°: ‡∏î‡∏∂‡∏á QR Code ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á
    }

    // --- 2. ‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡∏° ---
    async function fetchTeamList() {
        const teamListBody = document.getElementById('teamListBody');
        const teamCount = document.getElementById('teamCount');
        teamListBody.innerHTML = '<tr><td colspan="7">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</td></tr>'; // ‡∏õ‡∏£‡∏±‡∏ö colspan ‡πÄ‡∏õ‡πá‡∏ô 7

        try {
            // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡πà‡∏≤‡∏ô Backend Endpoint: /api/admin/teams
            const BACKEND_URL = 'https://badminton-sut-server.onrender.com'; // <--- ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢ URL ‡∏Ç‡∏≠‡∏á Render
            const response = await fetch('${BACKEND_URL}/api/admin/teams');
            const result = await response.json();

            if (response.ok) {
                teamCount.innerText = result.teams.length;
                renderTeamList(result.teams);
            } else {
                teamListBody.innerHTML = `<tr><td colspan="7" style="color: red;">‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${result.error}</td></tr>`;
            }

        } catch (error) {
            console.error('Error fetching teams:', error);
            teamListBody.innerHTML = `<tr><td colspan="7" style="color: red;">‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Server</td></tr>`;
        }
    }
    
    function renderTeamList(teams) {
        const teamListBody = document.getElementById('teamListBody');
        teamListBody.innerHTML = '';
        
        teams.forEach(team => {
            // ‡πÄ‡∏û‡∏¥‡πà‡∏°: ‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏π Slip ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
            const slipStatus = team.slip_path 
                ? `<a href="${team.slip_path}" target="_blank" style="color: #28a745; font-weight: bold;">(‡∏î‡∏π Slip)</a>`
                : '(‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ Slip)';
                
            const statusSelectHtml = `
                <select id="status_${team.id}" class="status-select">
                    <option value="üü° ‡∏£‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô" ${team.status === 'üü° ‡∏£‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô' ? 'selected' : ''}>üü° ‡∏£‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</option>
                    <option value="‚úÖ ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô" ${team.status === '‚úÖ ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô' ? 'selected' : ''}>‚úÖ ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô</option>
                    <option value="üîµ ‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô" ${team.status === 'üîµ ‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô' ? 'selected' : ''}>üîµ ‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</option>
                    <option value="üü¢ ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß" ${team.status === 'üü¢ ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß' ? 'selected' : ''}>üü¢ ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß</option>
                    <option value="üî¥ ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô/‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å" ${team.status === 'üî¥ ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô/‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' ? 'selected' : ''}>üî¥ ‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô/‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</option>
                </select>
            `;

            const row = teamListBody.insertRow();
            row.innerHTML = `
                <td>${team.team_code}</td>
                <td>${team.team_name}</td>
                <td>${team.level}</td>
                <td>
                    ${team.eval_method === 'clip' ? '‡∏Ñ‡∏•‡∏¥‡∏õ' : 'On-site'} 
                    ${team.eval_link ? `<a href="${team.eval_link}" target="_blank">(‡∏î‡∏π‡∏Ñ‡∏•‡∏¥‡∏õ)</a>` : ''}
                </td>
                <td>${slipStatus}</td> <td>${statusSelectHtml}</td>
                <td>
                    <button class="btn-view" onclick="showTeamDetails('${team.id}')"><i class="fas fa-eye"></i> ‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                    <button class="btn-update" onclick="updateTeamStatus('${team.id}')"><i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
                </td>
            `;
        });
    }
    
    // --- 3. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ---
    async function updateTeamStatus(teamId) {
        const newStatus = document.getElementById(`status_${teamId}`).value;
        if (!confirm(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡∏°‡πÄ‡∏õ‡πá‡∏ô "${newStatus}"?`)) {
            return;
        }

        try {
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å Backend Endpoint ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
            const BACKEND_URL = 'https://badminton-sut-server.onrender.com'; // <--- ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢ URL ‡∏Ç‡∏≠‡∏á Render
            const response = await fetch('${BACKEND_URL}/api/admin/update-status', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ team_id: teamId, new_status: newStatus })
            });
            
            const result = await response.json();
            
            if (response.ok) {
                alert(`‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${result.message}`);
                fetchTeamList(); // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡∏°‡πà
            } else {
                alert(`‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${result.error}`);
            }
        } catch (error) {
            console.error('Update status error:', error);
            alert('‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Server');
        }
    }

    // --- 4. ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÉ‡∏ô Modal ---
    async function showTeamDetails(teamId) {
        const modal = document.getElementById('detailModal');
        const modalContent = document.getElementById('modalContent');
        modalContent.innerHTML = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...';

        try {
            // ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Endpoint ‡πÉ‡∏´‡∏°‡πà)
            const BACKEND_URL = 'https://badminton-sut-server.onrender.com'; // <--- ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢ URL ‡∏Ç‡∏≠‡∏á Render
            const response = await fetch(`${BACKEND_URL}/api/admin/team-details/${teamId}`);
            const result = await response.json();

            if (response.ok) {
                const team = result.team;
                document.getElementById('modalTeamName').innerText = team.team_name;
                document.getElementById('modalTeamCode').innerText = team.team_code;
                
                const p1 = team.players.find(p => p.is_player_one);
                const p2 = team.players.find(p => !p.is_player_one);
                
                modalContent.innerHTML = `
                    <h4><i class="fas fa-clipboard-list"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Å‡∏≤‡∏£‡∏™‡∏°‡∏±‡∏Ñ‡∏£</h4>
                    <p><strong>‡∏£‡∏∏‡πà‡∏ô:</strong> ‡∏°‡∏∑‡∏≠ ${team.level}</p>
                    <p><strong>‡∏Ñ‡πà‡∏≤‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏£‡∏ß‡∏°:</strong> ${team.total_fee} ‡∏ö‡∏≤‡∏ó</p>
                    <p><strong>Link ‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô:</strong> ${team.eval_link ? `<a href="${team.eval_link}" target="_blank">${team.eval_link}</a>` : '‡πÑ‡∏°‡πà‡∏°‡∏µ'}</p>
                    <p><strong>Slip ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô:</strong> ${team.slip_path ? `<a href="${team.slip_path}" target="_blank" style="color: #28a745; font-weight: bold;">‡∏î‡∏π Slip</a>` : '‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î'}</p>
                    <hr>
                    
                    <h4><i class="fas fa-user"></i> ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà 1 (‡∏´‡∏±‡∏ß‡∏´‡∏ô‡πâ‡∏≤‡∏ó‡∏µ‡∏°)</h4>
                    <p><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> ${p1 ? p1.full_name : '‡πÑ‡∏°‡πà‡∏û‡∏ö'}</p>
                    <p><strong>‡∏£‡∏´‡∏±‡∏™:</strong> ${p1 ? p1.std_staff_id : '‡πÑ‡∏°‡πà‡∏û‡∏ö'}</p>
                    <p><strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</strong> ${p1 ? (p1.type === 'student' ? '‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤' : '‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£') : '‡πÑ‡∏°‡πà‡∏û‡∏ö'}</p>
                    <div style="text-align: center; margin-bottom: 10px;">
                        ${p1 && p1.photo_path ? `<a href="${p1.photo_path}" target="_blank"><img src="${p1.photo_path}" style="max-width: 150px; max-height: 150px; border: 1px solid #ccc;"/></a>` : '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û'}
                    </div>
                    
                    <h4><i class="fas fa-user-friends"></i> ‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà 2</h4>
                    <p><strong>‡∏ä‡∏∑‡πà‡∏≠:</strong> ${p2 ? p2.full_name : '‡πÑ‡∏°‡πà‡∏û‡∏ö'}</p>
                    <p><strong>‡∏£‡∏´‡∏±‡∏™:</strong> ${p2 ? p2.std_staff_id : '‡πÑ‡∏°‡πà‡∏û‡∏ö'}</p>
                    <p><strong>‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó:</strong> ${p2 ? (p2.type === 'student' ? '‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤' : '‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£') : '‡πÑ‡∏°‡πà‡∏û‡∏ö'}</p>
                    <div style="text-align: center; margin-bottom: 10px;">
                         ${p2 && p2.photo_path ? `<a href="${p2.photo_path}" target="_blank"><img src="${p2.photo_path}" style="max-width: 150px; max-height: 150px; border: 1px solid #ccc;"/></a>` : '‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û'}
                    </div>
                `;
                modal.style.display = 'block';
            } else {
                modalContent.innerHTML = `<p style="color: red;">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡∏°‡∏ô‡∏µ‡πâ</p>`;
                modal.style.display = 'block';
            }
        } catch (error) {
            console.error('Error fetching details:', error);
            modalContent.innerHTML = `<p style="color: red;">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Server</p>`;
            modal.style.display = 'block';
        }
    }

    // --- 5. ‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£ QR Code ---

    // ‡∏î‡∏∂‡∏á QR Code Path ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•
    async function fetchQrCodePath() {
        const qrDiv = document.getElementById('currentQr');
        qrDiv.innerHTML = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö QR Code ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô...';
        try {
             // ‡∏ï‡πâ‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á Endpoint ‡πÉ‡∏´‡∏°‡πà‡πÉ‡∏ô server.js ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏î‡∏∂‡∏á config
             const BACKEND_URL = 'https://badminton-sut-server.onrender.com'; // <--- ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢ URL ‡∏Ç‡∏≠‡∏á Render
             const response = await fetch('${BACKEND_URL}/api/config/qr_code_path');
             
             const result = await response.json();

             if (response.ok && result.qr_code_path) {
                qrDiv.innerHTML = `
                    <p style="color: green; font-weight: bold;"><i class="fas fa-check-circle"></i> QR Code ‡∏ñ‡∏π‡∏Å‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß:</p>
                    <a href="${result.qr_code_path}" target="_blank"><img src="${result.qr_code_path}" style="max-width: 150px; border: 1px solid #ccc; padding: 5px;"/></a>
                `;
             } else {
                qrDiv.innerHTML = `<p style="color: red; font-weight: bold;"><i class="fas fa-exclamation-triangle"></i> ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î QR Code</p>`;
             }
            
        } catch (e) {
            console.error('Error fetching QR:', e);
            qrDiv.innerHTML = '<p style="color: red;">‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏∂‡∏á QR Code ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô</p>';
        }
    }

    // Event Listener ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î QR Code
    document.getElementById('uploadQrButton').addEventListener('click', async function() {
        const qrFile = document.getElementById('qrCodeFile').files[0];
        const messageDiv = document.getElementById('qrUploadMessage');
        
        if (!qrFile) {
            messageDiv.innerHTML = '<p style="color: red;">‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå QR Code</p>';
            return;
        }

        const formData = new FormData();
        formData.append('qr_code', qrFile); // ‡∏ä‡∏∑‡πà‡∏≠ field ‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏£‡∏á‡∏Å‡∏±‡∏ö 'qr_code' ‡πÉ‡∏ô server.js

        this.disabled = true;
        this.innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î...';
        messageDiv.innerHTML = '';
        
        try {
            // ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å API Endpoint ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î QR Code
            const BACKEND_URL = 'https://badminton-sut-server.onrender.com'; // <--- ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢ URL ‡∏Ç‡∏≠‡∏á Render
            const response = await fetch('${BACKEND_URL}/api/admin/upload-qr', {
                method: 'POST',
                body: formData
            });

            const result = await response.json();

            if (response.ok) {
                messageDiv.innerHTML = `<p style="color: green; font-weight: bold;">‚úÖ ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: <a href="${result.url}" target="_blank">‡∏î‡∏π QR Code</a></p>`;
                fetchQrCodePath(); // ‡πÇ‡∏´‡∏•‡∏î path ‡πÉ‡∏´‡∏°‡πà‡∏°‡∏≤‡πÅ‡∏™‡∏î‡∏á
            } else {
                messageDiv.innerHTML = `<p style="color: red;">‚ùå ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${result.error}</p>`;
            }
            
        } catch (error) {
            messageDiv.innerHTML = '<p style="color: red;">‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Server</p>';
        } finally {
            this.disabled = false;
            this.innerText = '‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÅ‡∏•‡∏∞‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å QR Code';
        }
    });

    // --- 6. Event Listeners ‡∏´‡∏•‡∏±‡∏Å ---

    // Login Button
    document.getElementById('loginButton').addEventListener('click', async () => {
        const email = document.getElementById('adminEmail').value;
        const password = document.getElementById('adminPassword').value;
        const errorDiv = document.getElementById('loginError');
        errorDiv.innerText = '';
        
        if (email !== 'sutbadminton@gmail.com') {
             errorDiv.innerText = '‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå‡∏Å‡∏≤‡∏£‡πÄ‡∏Ç‡πâ‡∏≤‡∏ñ‡∏∂‡∏á‡∏ñ‡∏π‡∏Å‡∏à‡∏≥‡∏Å‡∏±‡∏î';
             return;
        }

        try {
            // ‡πÉ‡∏ä‡πâ supabaseClient
            const { error } = await supabaseClient.auth.signInWithPassword({ email, password });

            if (error) {
                errorDiv.innerText = 'Login ‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + error.message;
            } else {
                checkAuth();
            }
        } catch (e) {
            errorDiv.innerText = '‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠';
            console.error('Login Error:', e);
        }
    });

    // Logout Button
    document.getElementById('logoutButton').addEventListener('click', async () => {
        // ‡πÉ‡∏ä‡πâ supabaseClient
        await supabaseClient.auth.signOut();
        showLogin();
    });

    // ‡∏õ‡∏¥‡∏î Modal ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ô‡∏≠‡∏Å Modal
    window.onclick = function(event) {
        if (event.target == document.getElementById('detailModal')) {
            document.getElementById('detailModal').style.display = "none";
        }
    }

    // 7. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡πå
    checkAuth();
</script>
</body>
</html>