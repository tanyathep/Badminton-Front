<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ - Badminton SUT 2025</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* CSS ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏µ‡πà‡∏ú‡∏°‡πÉ‡∏´‡πâ‡πÑ‡∏ß‡πâ‡πÉ‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ó‡∏µ‡πà‡πÅ‡∏•‡πâ‡∏ß ‡∏¢‡∏±‡∏á‡∏Ñ‡∏á‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏î‡πâ‡∏î‡∏µ */
        .status-badge { padding: 5px 10px; border-radius: 5px; color: white; font-weight: bold; display: inline-block; margin-left: 10px; }
        .status-badge.status-üü°-‡∏£‡∏≠‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô { background-color: #f39c12; }
        .status-badge.status-‚úÖ-‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô { background-color: #2ecc71; }
        .status-badge.status-üîµ-‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô { background-color: #3498db; }
        .status-badge.status-üü¢-‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß { background-color: #27ae60; }
        .status-badge.status-üî¥-‡πÑ‡∏°‡πà‡∏ú‡πà‡∏≤‡∏ô/‡∏ñ‡∏π‡∏Å‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å { background-color: #e74c3c; }
        
        .payment-section { margin-top: 30px; padding: 20px; border: 2px solid #f39c12; border-radius: 8px; background-color: #fff9f5; }
        .payment-section h3 { color: #f39c12; border-bottom: 2px solid #f39c12; padding-bottom: 10px; margin-top: 0; }
        .qr-image { max-width: 200px; border: 1px solid #ccc; padding: 10px; background-color: white; box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1); }
        .uploaded-slip-info { padding: 15px; border: 1px dashed #3498db; border-radius: 5px; background-color: #e9f5ff; color: #3498db; font-weight: bold; text-align: center; }
    </style>
</head>
<body>
    <div class="header">
        <div class="logo">BADMINTON SUT 2025</div>
        <div class="header-nav">
            <a href="index.html"><i class="fas fa-home"></i> ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
        </div>
    </div>
    
    <div class="container">
        <div class="card status-checker">
            <h2><i class="fas fa-search"></i> ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡∏°</h2>
            <div class="form-group">
                <label for="teamName">‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°:</label> 
                <input type="text" id="teamName" placeholder="‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°‡∏ó‡∏µ‡πà‡πÉ‡∏ä‡πâ‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô" required>
            </div>
            <button id="checkStatusButton" class="submit-button" style="width: 100%;"><i class="fas fa-check-circle"></i> ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</button>
            
            <div id="statusResult" class="status-result" style="display: none; margin-top: 30px; padding: 20px; border-radius: 8px; border: 1px solid #ccc;">
                </div>
            
            <div id="paymentSection" class="payment-section" style="display: none;">
                </div>
            
        </div>
    </div>

    <script>
        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏´‡∏•‡∏±‡∏Å: ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ó‡∏µ‡∏°‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°
        document.getElementById('checkStatusButton').addEventListener('click', async function() {
            // *** ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç: ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡∏à‡∏≤‡∏Å teamCode ‡πÄ‡∏õ‡πá‡∏ô teamName ***
            const teamNameInput = document.getElementById('teamName');
            const teamName = teamNameInput.value.trim(); 
            const statusResultDiv = document.getElementById('statusResult');
            const paymentSection = document.getElementById('paymentSection');
            const button = this;

            if (!teamName) {
                alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°');
                return;
            }

            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...';
            statusResultDiv.style.display = 'none';
            paymentSection.style.display = 'none';
            statusResultDiv.innerHTML = '';


            try {
                // *** ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Endpoint: ‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡πÉ‡∏ä‡πâ /api/status/name/:teamName ‡πÉ‡∏´‡∏°‡πà ***
                const BACKEND_URL = 'https://badminton-sut-server.onrender.com'; // <--- ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢ URL ‡∏Ç‡∏≠‡∏á Render
                const response = await fetch(`${BACKEND_URL}/api/status/name/${teamName}`);
                const result = await response.json();

                if (response.ok) {
                    const team = result.team;
                    const qrCodePath = result.qr_code_path; 
                    
                    // 1. ‡πÅ‡∏™‡∏î‡∏á‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ó‡∏µ‡∏°‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ
                    let playersHtml = '';
                    team.players.forEach(p => {
                        playersHtml += `
                            <li>${p.full_name} (${p.type === 'student' ? '‡∏ô‡∏±‡∏Å‡∏®‡∏∂‡∏Å‡∏©‡∏≤' : '‡∏ö‡∏∏‡∏Ñ‡∏•‡∏≤‡∏Å‡∏£'}) ‡∏£‡∏´‡∏±‡∏™: ${p.std_staff_id}</li>
                        `;
                    });

                    statusResultDiv.innerHTML = `
                        <h3><i class="fas fa-info-circle"></i> ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì (${team.team_code})</h3>
                        <p><strong>‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏°:</strong> ${team.team_name}</p>
                        <p><strong>‡∏£‡∏∏‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏™‡∏°‡∏±‡∏Ñ‡∏£:</strong> ‡∏°‡∏∑‡∏≠ ${team.level}</p>
                        <p><strong>‡∏Ñ‡πà‡∏≤‡∏™‡∏°‡∏±‡∏Ñ‡∏£‡∏£‡∏ß‡∏°:</strong> ${team.total_fee} ‡∏ö‡∏≤‡∏ó</p>
                        <p><strong>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô:</strong> <span class="status-badge status-${team.status.toLowerCase().replace(/ /g, '-')}" style="font-weight: bold;">${team.status}</span></p>
                        <p><strong>‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô:</strong>
                            <ul style="list-style-type: none; padding-left: 0; margin-top: 5px;">${playersHtml}</ul>
                        </p>
                    `;
                    
                    // 2. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
                    if (team.status === '‚úÖ ‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô') {
                        // ‡∏ó‡∏µ‡∏°‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
                        if (qrCodePath) {
                            paymentSection.innerHTML = `
                                <h3>üí∏ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</h3>
                                <p>‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞: <strong style="color: #e67e22; font-size: 1.2em;">${team.total_fee}</strong> ‡∏ö‡∏≤‡∏ó</p>
                                <div style="text-align: center; margin: 20px 0;">
                                    <h4>‡∏™‡πÅ‡∏Å‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÄ‡∏û‡∏¢‡πå)</h4>
                                    <img src="${qrCodePath}" alt="QR Code" class="qr-image">
                                </div>
                                
                                <div class="form-group">
                                    <label for="slipFile"><i class="fas fa-file-upload"></i> ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏´‡∏•‡∏±‡∏Å‡∏ê‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (Slip):</label>
                                    <input type="file" id="slipFile" accept="image/*,application/pdf" required>
                                    <small style="color: #f44336;">*‡πÑ‡∏ü‡∏•‡πå‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û (JPG/PNG) ‡∏´‡∏£‡∏∑‡∏≠ PDF ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô</small>
                                </div>
                                
                                <button id="uploadSlipButton" class="submit-button" style="background-color: #28a745; width: 100%;" data-teamcode="${team.team_code}"><i class="fas fa-check-circle"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</button>
                                <div id="uploadMessage" style="margin-top: 15px;"></div>
                            `;
                        } else {
                            paymentSection.innerHTML = `<p style="color: red; font-weight: bold;"><i class="fas fa-exclamation-triangle"></i> Admin ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î QR Code ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠ Admin</p>`;
                        }
                        paymentSection.style.display = 'block';

                    } else if (team.status === 'üîµ ‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô' || team.status === 'üü¢ ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß') {
                        // ‡∏ó‡∏µ‡∏°‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö/‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß
                        paymentSection.innerHTML = `
                            <div class="uploaded-slip-info">
                                <p><i class="fas fa-clock"></i> ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${team.status}</p>
                                <p>‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î Slip ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß: 
                                ${team.slip_path ? `<a href="${team.slip_path}" target="_blank" style="color: inherit;">(‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π Slip)</a>` : ''}
                                </p>
                                <p>Admin ‡∏à‡∏∞‡∏ó‡∏≥‡∏Å‡∏≤‡∏£‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡∏∞‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡πá‡∏ô "‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡πÅ‡∏•‡πâ‡∏ß" ‡πÉ‡∏´‡πâ‡πÉ‡∏ô‡∏†‡∏≤‡∏¢‡∏´‡∏•‡∏±‡∏á</p>
                            </div>
                        `;
                        paymentSection.style.display = 'block';
                    }

                    statusResultDiv.style.display = 'block';

                } else {
                    // *** ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° Error ‡πÉ‡∏´‡πâ‡∏™‡∏≠‡∏î‡∏Ñ‡∏•‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏î‡πâ‡∏ß‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏ó‡∏µ‡∏° ***
                    statusResultDiv.innerHTML = `<p style="color: red;"><i class="fas fa-times-circle"></i> ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ó‡∏µ‡∏°‡∏ä‡∏∑‡πà‡∏≠ "${teamName}" ‡∏ô‡∏µ‡πâ ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: ${result.error}</p>`;
                    statusResultDiv.style.display = 'block';
                }

            } catch (error) {
                console.error('Network or Server Error:', error);
                statusResultDiv.innerHTML = `<p style="color: red;"><i class="fas fa-server"></i> ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Å‡∏±‡∏ö Server</p>`;
                statusResultDiv.style.display = 'block';
            } finally {
                button.disabled = false;
                button.innerHTML = '<i class="fas fa-check-circle"></i> ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞';
            }
        });

        // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î Slip (‡πÉ‡∏ä‡πâ Event Delegation)
        document.addEventListener('click', async function(event) {
            if (event.target && event.target.id === 'uploadSlipButton') {
                const teamCode = event.target.getAttribute('data-teamcode');
                const slipFile = document.getElementById('slipFile').files[0];
                const uploadMessage = document.getElementById('uploadMessage');
                
                if (!slipFile) {
                    uploadMessage.innerHTML = '<p style="color: red;"><i class="fas fa-exclamation-circle"></i> ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå Slip ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</p>';
                    return;
                }

                const formData = new FormData();
                formData.append('slip', slipFile);

                event.target.disabled = true;
                event.target.innerHTML = '<i class="fas fa-upload fa-spin"></i> ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î...';
                uploadMessage.innerHTML = '';
                
                try {
                    // ‡πÉ‡∏ä‡πâ teamCode ‡∏ó‡∏µ‡πà‡∏î‡∏∂‡∏á‡∏°‡∏≤‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡∏°‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á API
                    const BACKEND_URL = 'https://badminton-sut-server.onrender.com'; // <--- ‡πÅ‡∏ó‡∏ô‡∏ó‡∏µ‡πà‡∏î‡πâ‡∏ß‡∏¢ URL ‡∏Ç‡∏≠‡∏á Render
                    const response = await fetch(`${BACKEND_URL}/api/upload-slip/${teamCode}`, { 
                        method: 'POST',
                        body: formData 
                    });

                    const result = await response.json();

                    if (response.ok) {
                        uploadMessage.innerHTML = `<p style="color: green; font-weight: bold;"><i class="fas fa-check"></i> ${result.message}</p>`;
                        // ‡πÇ‡∏´‡∏•‡∏î‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏±‡∏ô‡∏ó‡∏µ ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠
                        document.getElementById('checkStatusButton').click(); 
                    } else {
                        uploadMessage.innerHTML = `<p style="color: red;"><i class="fas fa-times"></i> ‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ${result.error}</p>`;
                    }
                    
                } catch (error) {
                    console.error('Upload error:', error);
                    uploadMessage.innerHTML = '<p style="color: red;"><i class="fas fa-server"></i> ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠ Server</p>';
                } finally {
                    event.target.disabled = false;
                    event.target.innerHTML = '<i class="fas fa-check-circle"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô';
                }
            }
        });
    </script>
</body>
</html>
